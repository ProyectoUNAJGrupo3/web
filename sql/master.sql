-- MySQL Script generated by MySQL Workbench
-- 09/04/16 16:38:27
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema unaj_proyecto
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `unaj_proyecto` ;

-- -----------------------------------------------------
-- Schema unaj_proyecto
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `unaj_proyecto` DEFAULT CHARACTER SET utf8 ;
USE `unaj_proyecto` ;

-- -----------------------------------------------------
-- Table `unaj_proyecto`.`Roles`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `unaj_proyecto`.`Roles` ;

CREATE TABLE IF NOT EXISTS `unaj_proyecto`.`Roles` (
  `RolID` INT NOT NULL,
  `Descripcion` VARCHAR(45) NULL,
  PRIMARY KEY (`RolID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `unaj_proyecto`.`Personas`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `unaj_proyecto`.`Personas` ;

CREATE TABLE IF NOT EXISTS `unaj_proyecto`.`Personas` (
  `PersonaID` INT NOT NULL,
  `Usuario` VARCHAR(45) NULL,
  `Contraseña` VARCHAR(45) NULL,
  `Nombre` VARCHAR(45) NULL,
  `Telefono` VARCHAR(45) NULL,
  `Email` VARCHAR(45) NULL,
  `RolID` INT NOT NULL,
  PRIMARY KEY (`PersonaID`),
  CONSTRAINT `fk_Personas_Roles`
    FOREIGN KEY (`RolID`)
    REFERENCES `unaj_proyecto`.`Roles` (`RolID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_Personas_Roles_idx` ON `unaj_proyecto`.`Personas` (`RolID` ASC);


-- -----------------------------------------------------
-- Table `unaj_proyecto`.`Vehiculos`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `unaj_proyecto`.`Vehiculos` ;

CREATE TABLE IF NOT EXISTS `unaj_proyecto`.`Vehiculos` (
  `VehiculoID` INT NOT NULL,
  `Matricula` VARCHAR(45) NULL,
  `Modelo` VARCHAR(45) NULL,
  `Marca` VARCHAR(45) NULL,
  `Estado` TINYINT NOT NULL,
  `FechaAlta` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `FechaBaja` DATETIME NULL,
  PRIMARY KEY (`VehiculoID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `unaj_proyecto`.`Agencias`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `unaj_proyecto`.`Agencias` ;

CREATE TABLE IF NOT EXISTS `unaj_proyecto`.`Agencias` (
  `AgenciaID` INT NOT NULL,
  `Nombre` VARCHAR(45) NOT NULL,
  `Telefono` VARCHAR(45) NULL,
  `Email` VARCHAR(45) NULL,
  `Estado` TINYINT NOT NULL,
  PRIMARY KEY (`AgenciaID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `unaj_proyecto`.`Turnos`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `unaj_proyecto`.`Turnos` ;

CREATE TABLE IF NOT EXISTS `unaj_proyecto`.`Turnos` (
  `TurnoID` INT NOT NULL,
  `PersonaID` INT NOT NULL,
  `FechaApertura` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `FechaCierre` DATETIME NULL,
  `Estado` TINYINT NOT NULL COMMENT '0 - Abierta\n1 - Cerrada',
  PRIMARY KEY (`TurnoID`),
  CONSTRAINT `fk_Turnos_Personas`
    FOREIGN KEY (`PersonaID`)
    REFERENCES `unaj_proyecto`.`Personas` (`PersonaID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_Turnos_Personas1_idx` ON `unaj_proyecto`.`Turnos` (`PersonaID` ASC);


-- -----------------------------------------------------
-- Table `unaj_proyecto`.`Tarifas`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `unaj_proyecto`.`Tarifas` ;

CREATE TABLE IF NOT EXISTS `unaj_proyecto`.`Tarifas` (
  `TarifaID` INT NOT NULL,
  `Comision` DOUBLE NULL,
  `AgenciaID` INT NOT NULL,
  `ViajeMinimo` DOUBLE NULL,
  `KmMinimo` DOUBLE NULL,
  `PrecioKM` DOUBLE NOT NULL,
  `Estado` TINYINT NOT NULL,
  PRIMARY KEY (`TarifaID`),
  CONSTRAINT `fk_Tarifas_Agencias`
    FOREIGN KEY (`AgenciaID`)
    REFERENCES `unaj_proyecto`.`Agencias` (`AgenciaID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_Tarifas_Agencias_idx` ON `unaj_proyecto`.`Tarifas` (`AgenciaID` ASC);


-- -----------------------------------------------------
-- Table `unaj_proyecto`.`Viajes`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `unaj_proyecto`.`Viajes` ;

CREATE TABLE IF NOT EXISTS `unaj_proyecto`.`Viajes` (
  `ViajeID` INT NOT NULL,
  `ChoferID` INT NULL,
  `VehiculoID` INT NULL,
  `TarifaID` INT NOT NULL,
  `TurnoID` INT NOT NULL,
  `AgenciaID` INT NOT NULL,
  `PersonaID` INT NULL COMMENT 'Si el viaje solicitado es manualmente (Personal o por Telefono) el usuario puede ser NULL ya que no se tiene registro en ese momento.',
  `FechaEmision` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `FechaSalida` DATETIME NULL,
  `ViajeTipo` TINYINT NOT NULL COMMENT 'Viajes solicitados con la siguiente modalidad:\n\n0 - Web\n1 - Personal\n2 - Telefonico',
  `OrigenCoordenadas` VARCHAR(200) NULL,
  `DestinoCoordenadas` VARCHAR(200) NULL,
  `OrigenDireccion` VARCHAR(200) NULL,
  `DestinoDireccion` VARCHAR(200) NULL,
  `Comentario` VARCHAR(200) NULL,
  `ImporteTotal` DOUBLE NOT NULL DEFAULT 0,
  `Distancia` DOUBLE NULL,
  `Estado` TINYINT NOT NULL COMMENT '0 - Pagado (En viaje)\n1 - Reservado\n2 - Cancelado\n3 - Finalizado (Cierre de circuito)\n',
  PRIMARY KEY (`ViajeID`),
  CONSTRAINT `fk_Viajes_Personas`
    FOREIGN KEY (`PersonaID`)
    REFERENCES `unaj_proyecto`.`Personas` (`PersonaID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Viajes_Vehiculos`
    FOREIGN KEY (`VehiculoID`)
    REFERENCES `unaj_proyecto`.`Vehiculos` (`VehiculoID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Viajes_Agencias`
    FOREIGN KEY (`AgenciaID`)
    REFERENCES `unaj_proyecto`.`Agencias` (`AgenciaID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Viajes_Turnos`
    FOREIGN KEY (`TurnoID`)
    REFERENCES `unaj_proyecto`.`Turnos` (`TurnoID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Viajes_Tarifas1`
    FOREIGN KEY (`TarifaID`)
    REFERENCES `unaj_proyecto`.`Tarifas` (`TarifaID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Viajes_Choferes`
    FOREIGN KEY (`ChoferID`)
    REFERENCES `unaj_proyecto`.`Personas` (`PersonaID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_Viajes_Vehiculos1_idx` ON `unaj_proyecto`.`Viajes` (`VehiculoID` ASC);

CREATE INDEX `fk_Viajes_Agencias1_idx` ON `unaj_proyecto`.`Viajes` (`AgenciaID` ASC);

CREATE INDEX `fk_Viajes_Choferes1_idx` ON `unaj_proyecto`.`Viajes` (`ChoferID` ASC);

CREATE INDEX `fk_Viajes_Turnos1_idx` ON `unaj_proyecto`.`Viajes` (`TurnoID` ASC);

CREATE INDEX `fk_Viajes_Tarifas1_idx` ON `unaj_proyecto`.`Viajes` (`TarifaID` ASC);

CREATE INDEX `fk_Viajes_Personas_idx` ON `unaj_proyecto`.`Viajes` (`PersonaID` ASC);


-- -----------------------------------------------------
-- Table `unaj_proyecto`.`Calificaciones`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `unaj_proyecto`.`Calificaciones` ;

CREATE TABLE IF NOT EXISTS `unaj_proyecto`.`Calificaciones` (
  `CalificacionID` INT NOT NULL,
  `ViajeID` INT NOT NULL,
  `Quien` INT NOT NULL,
  `ParaQuien` INT NOT NULL,
  `Puntaje` INT NOT NULL,
  `Fecha` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `Comentario` VARCHAR(200) NULL,
  PRIMARY KEY (`CalificacionID`),
  CONSTRAINT `fk_Calificaciones_PersonasQuien`
    FOREIGN KEY (`Quien`)
    REFERENCES `unaj_proyecto`.`Personas` (`PersonaID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Calificaciones_Viajes`
    FOREIGN KEY (`ViajeID`)
    REFERENCES `unaj_proyecto`.`Viajes` (`ViajeID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Calificaciones_PersonasParaQuien`
    FOREIGN KEY (`ParaQuien`)
    REFERENCES `unaj_proyecto`.`Personas` (`PersonaID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_Calificaciones_Viajes1_idx` ON `unaj_proyecto`.`Calificaciones` (`ViajeID` ASC);

CREATE INDEX `fk_Calificaciones_PersonasQuien_idx` ON `unaj_proyecto`.`Calificaciones` (`Quien` ASC);

CREATE INDEX `afds_idx` ON `unaj_proyecto`.`Calificaciones` (`ParaQuien` ASC);


-- -----------------------------------------------------
-- Table `unaj_proyecto`.`Direcciones`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `unaj_proyecto`.`Direcciones` ;

CREATE TABLE IF NOT EXISTS `unaj_proyecto`.`Direcciones` (
  `DireccionID` INT NOT NULL,
  `Direccion` VARCHAR(200) NOT NULL,
  `DireccionCoordenada` VARCHAR(200) NOT NULL,
  `Default` TINYINT NOT NULL COMMENT '1 - Es la direccion por defecto.\n0 - Es una de las direcciones del Cliente/Agencia.',
  `DireccionTipo` TINYINT NOT NULL COMMENT '0 - Direccion de Cliente.\n1 - Direccion de Agencia.',
  `AplicacionID` INT NOT NULL COMMENT 'Corresponde al ID del registro segun el DireccionTipo.\n\nEj: \nSi DireccionTipo= 0 entonces AplicacionID contiene el ID de una Persona.\nSi DireccionTipo = 1 entonces AplicacionID contiene el ID de una Agencia.',
  PRIMARY KEY (`DireccionID`),
  CONSTRAINT `fk_Direcciones_Personas`
    FOREIGN KEY (`AplicacionID`)
    REFERENCES `unaj_proyecto`.`Personas` (`PersonaID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Direcciones_Agencias`
    FOREIGN KEY (`AplicacionID`)
    REFERENCES `unaj_proyecto`.`Agencias` (`AgenciaID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
KEY_BLOCK_SIZE = 8;

CREATE INDEX `fk_Direcciones_Personas1_idx` ON `unaj_proyecto`.`Direcciones` (`AplicacionID` ASC);

CREATE INDEX `fk_Direcciones_Agecias_idx` ON `unaj_proyecto`.`Direcciones` (`AplicacionID` ASC);


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `unaj_proyecto`.`Roles`
-- -----------------------------------------------------
START TRANSACTION;
USE `unaj_proyecto`;
INSERT INTO `unaj_proyecto`.`Roles` (`RolID`, `Descripcion`) VALUES (1, 'Administrador');
INSERT INTO `unaj_proyecto`.`Roles` (`RolID`, `Descripcion`) VALUES (2, 'Recepcionista');
INSERT INTO `unaj_proyecto`.`Roles` (`RolID`, `Descripcion`) VALUES (3, 'Chofer');
INSERT INTO `unaj_proyecto`.`Roles` (`RolID`, `Descripcion`) VALUES (4, 'Cliente');

COMMIT;


-- -----------------------------------------------------
-- Data for table `unaj_proyecto`.`Personas`
-- -----------------------------------------------------
START TRANSACTION;
USE `unaj_proyecto`;
INSERT INTO `unaj_proyecto`.`Personas` (`PersonaID`, `Usuario`, `Contraseña`, `Nombre`, `Telefono`, `Email`, `RolID`) VALUES (1, 'emendez', 'emendez', 'Mendez Alejandro Ezequiel', '42744254', 'mendezalejandro.e@gmail.com', 1);
INSERT INTO `unaj_proyecto`.`Personas` (`PersonaID`, `Usuario`, `Contraseña`, `Nombre`, `Telefono`, `Email`, `RolID`) VALUES (2, 'lsilva', 'lsilva', 'Lilian Silva', '42744466', 'lilian@gmail.com', 2);
INSERT INTO `unaj_proyecto`.`Personas` (`PersonaID`, `Usuario`, `Contraseña`, `Nombre`, `Telefono`, `Email`, `RolID`) VALUES (3, 'arodriguez', 'arodriguez', 'Aldo Rodriguez', NULL, NULL, 3);
INSERT INTO `unaj_proyecto`.`Personas` (`PersonaID`, `Usuario`, `Contraseña`, `Nombre`, `Telefono`, `Email`, `RolID`) VALUES (4, 'imorales', 'imorales', 'Ignacio Morales', NULL, NULL, 4);
INSERT INTO `unaj_proyecto`.`Personas` (`PersonaID`, `Usuario`, `Contraseña`, `Nombre`, `Telefono`, `Email`, `RolID`) VALUES (5, 'bvitucci', 'bvitucci', 'Bruno Vitucci', NULL, NULL, 4);

COMMIT;


-- -----------------------------------------------------
-- Data for table `unaj_proyecto`.`Vehiculos`
-- -----------------------------------------------------
START TRANSACTION;
USE `unaj_proyecto`;
INSERT INTO `unaj_proyecto`.`Vehiculos` (`VehiculoID`, `Matricula`, `Modelo`, `Marca`, `Estado`, `FechaAlta`, `FechaBaja`) VALUES (1, 'GIM268', '2016', 'Renault', 0, '2016-08-31 23:00:00', NULL);
INSERT INTO `unaj_proyecto`.`Vehiculos` (`VehiculoID`, `Matricula`, `Modelo`, `Marca`, `Estado`, `FechaAlta`, `FechaBaja`) VALUES (2, 'TOR345', '2015', 'Fiat Punto', 0, '2016-08-31 23:00:00', NULL);

COMMIT;


-- -----------------------------------------------------
-- Data for table `unaj_proyecto`.`Agencias`
-- -----------------------------------------------------
START TRANSACTION;
USE `unaj_proyecto`;
INSERT INTO `unaj_proyecto`.`Agencias` (`AgenciaID`, `Nombre`, `Telefono`, `Email`, `Estado`) VALUES (1, 'Remiseria LA ESTRELLA', '011 4237-1280', 'remiamigos@remis.com.ar', 0);
INSERT INTO `unaj_proyecto`.`Agencias` (`AgenciaID`, `Nombre`, `Telefono`, `Email`, `Estado`) VALUES (2, 'O\'Clock Remis', '011 4287-7331', 'oclock@remisys.com.ar', 0);

COMMIT;


-- -----------------------------------------------------
-- Data for table `unaj_proyecto`.`Turnos`
-- -----------------------------------------------------
START TRANSACTION;
USE `unaj_proyecto`;
INSERT INTO `unaj_proyecto`.`Turnos` (`TurnoID`, `PersonaID`, `FechaApertura`, `FechaCierre`, `Estado`) VALUES (1, 2, '2016-08-25 23:00:00', NULL, 0);

COMMIT;


-- -----------------------------------------------------
-- Data for table `unaj_proyecto`.`Tarifas`
-- -----------------------------------------------------
START TRANSACTION;
USE `unaj_proyecto`;
INSERT INTO `unaj_proyecto`.`Tarifas` (`TarifaID`, `Comision`, `AgenciaID`, `ViajeMinimo`, `KmMinimo`, `PrecioKM`, `Estado`) VALUES (1, 20, 1, 100, 5, 10.50, 0);
INSERT INTO `unaj_proyecto`.`Tarifas` (`TarifaID`, `Comision`, `AgenciaID`, `ViajeMinimo`, `KmMinimo`, `PrecioKM`, `Estado`) VALUES (2, 35, 2, 80, 4, 8, 0);

COMMIT;


-- -----------------------------------------------------
-- Data for table `unaj_proyecto`.`Viajes`
-- -----------------------------------------------------
START TRANSACTION;
USE `unaj_proyecto`;
INSERT INTO `unaj_proyecto`.`Viajes` (`ViajeID`, `ChoferID`, `VehiculoID`, `TarifaID`, `TurnoID`, `AgenciaID`, `PersonaID`, `FechaEmision`, `FechaSalida`, `ViajeTipo`, `OrigenCoordenadas`, `DestinoCoordenadas`, `OrigenDireccion`, `DestinoDireccion`, `Comentario`, `ImporteTotal`, `Distancia`, `Estado`) VALUES (1, 1, 1, 1, 1, 1, 4, '2016-08-31 23:00:00', '2016-08-31 23:00:00', 0, '{Lat: 1351.153, Lon:1564.2354}', '{Lat:357438.54, Lon:3431.35}', 'Barrio Parana', 'Estacion Florencio Varela', '', 150, 20, 0);
INSERT INTO `unaj_proyecto`.`Viajes` (`ViajeID`, `ChoferID`, `VehiculoID`, `TarifaID`, `TurnoID`, `AgenciaID`, `PersonaID`, `FechaEmision`, `FechaSalida`, `ViajeTipo`, `OrigenCoordenadas`, `DestinoCoordenadas`, `OrigenDireccion`, `DestinoDireccion`, `Comentario`, `ImporteTotal`, `Distancia`, `Estado`) VALUES (2, 2, 2, 1, 1, 1, 5, '2016-08-31 23:00:00', '2016-08-31 23:00:00', 0, '{Lat: 1354.654, Lon: 4583.58}', '{Lat:3164.54, Lon:4345.87}', 'Barrio Parana', 'Estacion Quilmes', 'Carga gas en durante el viaje.', 250, 35, 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `unaj_proyecto`.`Calificaciones`
-- -----------------------------------------------------
START TRANSACTION;
USE `unaj_proyecto`;
INSERT INTO `unaj_proyecto`.`Calificaciones` (`CalificacionID`, `ViajeID`, `Quien`, `ParaQuien`, `Puntaje`, `Fecha`, `Comentario`) VALUES (1, 2, 5, 2, 10, '2016-08-31 23:00:00', 'El chofer me toco la jalea pero todo bien igual. Recomendado');

COMMIT;


-- -----------------------------------------------------
-- Data for table `unaj_proyecto`.`Direcciones`
-- -----------------------------------------------------
START TRANSACTION;
USE `unaj_proyecto`;
INSERT INTO `unaj_proyecto`.`Direcciones` (`DireccionID`, `Direccion`, `DireccionCoordenada`, `Default`, `DireccionTipo`, `AplicacionID`) VALUES (1, 'Calle Lopez 1444', '[{Latitud:25165.1651651, Longitud:34611.354}]', 1, 0, 1);
INSERT INTO `unaj_proyecto`.`Direcciones` (`DireccionID`, `Direccion`, `DireccionCoordenada`, `Default`, `DireccionTipo`, `AplicacionID`) VALUES (2, 'Calle Perez 1555', '[{Latitud:252435.1651651, Longitud:67511.354}]', 1, 1, 1);

COMMIT;